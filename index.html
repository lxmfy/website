<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/logo.svg">

    <!-- Primary Meta Tags -->
    <title>LXMFy - LXMF Bot Framework</title>
    <meta name="title" content="LXMFy - LXMF Bot Framework">
    <meta name="description" content="Create LXMF bots for the Reticulum Network. Features hot reloading, moderation tools, and spam protection.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lxmfy.github.io/">
    <meta property="og:title" content="LXMFy - LXMF Bot Framework">
    <meta property="og:description" content="Create LXMF bots for the Reticulum Network. Features hot reloading, moderation tools, and spam protection.">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://lxmfy.github.io/">
    <meta property="twitter:title" content="LXMFy - LXMF Bot Framework">
    <meta property="twitter:description" content="Create LXMF bots for the Reticulum Network. Features hot reloading, moderation tools, and spam protection.">

    <!-- Theme Color -->
    <meta name="theme-color" content="#0d1117">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Add Prism CSS -->
    <link href="/vendor/prism/prism-tomorrow.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Include header --> 
    <div id="header-placeholder"></div>

    <main>
        <section class="hero">
            <h1>LXMFy</h1>
            <p>Easily create <a class="link" href="https://github.com/markqvist/LXMF">LXMF</a> bots for the <a class="link" href="https://reticulum.network">Reticulum Network</a> with this framework.</p>
            <div class="version-badge">
                <a href="https://github.com/lxmfy/lxmfy/releases/latest" id="version-link">
                    <span id="version-text">Loading...</span>
                </a>
            </div>
            <div class="hero-commands">
                <div class="code-block small">
                    <pre><code class="language-python">pip install lxmfy</code></pre>
                </div>
                <div class="code-block small">
                    <pre><code class="language-python">lxmfy create mybot</code></pre>
                </div>
            </div>
            <p><a href="https://github.com/lxmfy/LXMFy/blob/main/CHANGELOG.md" class="link">View Changelog</a></p>
        </section>

        <section id="features">
            <h2>Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h3>First Message Handler</h3>
                    <p>Custom welcome messages for new users</p>
                </div>
                <div class="feature-card">
                    <h3>Storage Options</h3>
                    <p>SQLite or JSON storage</p>
                </div>
                <div class="feature-card">
                    <h3>Permission System</h3>
                    <p>Role-based access control with hierarchical permissions</p>
                </div>
                <div class="feature-card">
                    <h3>Hot Reloading</h3>
                    <p>Cog system for modular bot development</p>
                </div>
                <div class="feature-card">
                    <h3>Moderation</h3>
                    <p>Built-in commands for user management</p>
                </div>
                <div class="feature-card">
                    <h3>Help System</h3>
                    <p>Automatic command documentation and help</p>
                </div>
                <div class="feature-card">
                    <h3>Spam Protection</h3>
                    <p>Rate limiting and protection</p>
                </div>
                <div class="feature-card">
                    <h3>Transport Layer</h3>
                    <p>Path discovery and caching</p>
                </div>
            </div>
        </section>

        <section id="projects">
            <h2>Projects Using LXMFy</h2>
            <div class="slider">
                <div class="slide-track">
                    <div class="slide">
                        <a href="https://github.com/lxmfy/ollama-bot" target="_blank">
                            <h3>Ollama Bot</h3>
                            <p>Query LLM models</p>
                        </a>
                    </div>
                    <div class="slide">
                        <a href="https://github.com/lxmfy/weather-bot" target="_blank">
                            <h3>Weather Bot</h3>
                            <p>OpenWeatherMap Bot</p>
                        </a>
                    </div>
                    <div class="slide">
                        <a href="https://github.com/lxmfy/js8call-bot" target="_blank">
                            <h3>JS8Call Bot</h3>
                            <p>Receive JS8Call messages</p>
                        </a>
                    </div>
                    <div class="slide">
                        <a href="https://github.com/lxmfy/news-bot" target="_blank">
                            <h3>News Bot</h3>
                            <p>Get your daily news feeds!</p>
                        </a>
                    </div>
                    <div class="slide">
                        <a href="https://github.com/lxmfy/ollama-bot" target="_blank">
                            <h3>Ollama Bot</h3>
                            <p>Query LLM models</p>
                        </a>
                    </div>
                    <div class="slide">
                        <a href="https://github.com/lxmfy/weather-bot" target="_blank">
                            <h3>Weather Bot</h3>
                            <p>OpenWeatherMap Bot</p>
                        </a>
                    </div>
                    <div class="slide">
                        <a href="https://github.com/lxmfy/js8call-bot" target="_blank">
                            <h3>JS8Call Bot</h3>
                            <p>Receive JS8Call messages</p>
                        </a>
                    </div>
                    <div class="slide">
                        <a href="https://github.com/lxmfy/news-bot" target="_blank">
                            <h3>News Bot</h3>
                            <p>Get your daily news feeds!</p>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <section id="usage">
            <h3>Python Example</h3>
            <div class="code-block mobile-scroll">
                <pre><code class="language-python">from lxmfy import LXMFBot, Event, EventPriority

bot = LXMFBot(
    name="BasicBot",
    announce=600,
    command_prefix="/",
    first_message_enabled=True,
    storage_type="sqlite",
    storage_path="bot.db"
)

@bot.events.on("message_received")
async def on_message(event):
    print(f"New message from: {event.data['sender']}")

@bot.command(name="ping", description="Test if bot is responsive")
def ping(ctx):
    ctx.reply("Pong!")

@bot.command(name="echo", description="Echo back your message")
def echo(ctx):
    if ctx.args:
        ctx.reply(" ".join(ctx.args))
    else:
        ctx.reply("Please provide a message to echo")

if __name__ == "__main__":
    bot.run()</code></pre>
            </div>
        </section>

        <section id="developers">
            <h2>Framework Development</h2>
            
            <h3>Core Architecture</h3>
            <div class="reference-grid">
                <div class="reference-card">
                    <h4>Core Module</h4>
                    <p>Core bot functionality, message routing, permissions and command handling.</p>
                    <div class="code-block mobile-scroll">
                        <pre><code class="language-python">class LXMFBot:
            def __init__(self, **kwargs):
                self.transport = Transport()
                self.storage = Storage()
                self.permissions = PermissionManager()
                self.help_system = HelpSystem()
                
            def command(self, name, **kwargs):
                def decorator(func):
                    cmd = Command(name=name, **kwargs)
                    self.commands[name] = cmd
                    return func
                return decorator</code></pre>
                    </div>
                    <h5>Key Components</h5>
                    <ul>
                        <li><code>RNS/LXMF Integration</code> - Network handling</li>
                        <li><code>Permission System</code> - Role-based access control</li>
                        <li><code>Help System</code> - Command documentation</li>
                        <li><code>Spam Protection</code> - Rate limiting and moderation</li>
                        <li><code>Storage System</code> - Persistent data handling</li>
                        <li><code>Extension System</code> - Hot-reloadable modules</li>
                    </ul>
                </div>
        
                <div class="reference-card">
                    <h4>Permission System</h4>
                    <p>Role-based access control with hierarchical permissions.</p>
                    <div class="code-block mobile-scroll">
                        <pre><code class="language-python">class DefaultPerms(Flag):
            USE_BOT = auto()
            SEND_MESSAGES = auto()
            USE_COMMANDS = auto()
            MANAGE_USERS = auto()
            ALL = USE_BOT | SEND_MESSAGES | USE_COMMANDS | MANAGE_USERS
        
        @dataclass
        class Role:
            name: str
            permissions: DefaultPerms
            priority: int = 0
        
        class PermissionManager:
            def create_role(self, name, permissions):
                pass
            def assign_role(self, user, role):
                pass
            def has_permission(self, user, perm):
                pass</code></pre>
                    </div>
                    <h5>Features</h5>
                    <ul>
                        <li><code>Role System</code> - Hierarchical roles</li>
                        <li><code>Permission Flags</code> - Granular permissions</li>
                        <li><code>Priority System</code> - Role precedence</li>
                        <li><code>Persistence</code> - Stored role assignments</li>
                    </ul>
                </div>
        
                <div class="reference-card">
                    <h4>Help System</h4>
                    <p>Dynamic command documentation and help formatting.</p>
                    <div class="code-block mobile-scroll">
                        <pre><code class="language-python">@dataclass
        class CommandHelp:
            name: str
            description: str
            usage: Optional[str]
            examples: List[str]
            category: str
        
        class HelpFormatter:
            def format_command(self, command):
                pass
            def format_category(self, category):
                pass
        
        @bot.command(
            name="help",
            description="Show command help",
            usage="help [command]"
        )</code></pre>
                    </div>
                    <h5>Features</h5>
                    <ul>
                        <li><code>Command Help</code> - Usage documentation</li>
                        <li><code>Categories</code> - Command grouping</li>
                        <li><code>Examples</code> - Usage examples</li>
                        <li><code>Permissions</code> - Required permissions display</li>
                        <li><code>Custom Formatting</code> - Flexible output</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script src="/vendor/prism/prism.min.js"></script>
    <script src="/vendor/prism/prism-python.min.js"></script>
    <script src="/vendor/clipboard/clipboard.min.js"></script>
    
    <script>
        document.querySelectorAll('.code-block.small').forEach(block => {
            const code = block.querySelector('code');
            
            block.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(code.textContent);
                    block.classList.add('copied');
                    setTimeout(() => {
                        block.classList.remove('copied');
                    }, 1000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                }
            });
        });

        fetch('_includes/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-placeholder').innerHTML = data;
                const burgerMenu = document.querySelector('.burger-menu');
                const navLinks = document.querySelector('.nav-links');
                
                burgerMenu.addEventListener('click', (e) => {
                    e.stopPropagation();
                    burgerMenu.classList.toggle('active');
                    navLinks.classList.toggle('active');
                });

                document.querySelectorAll('.nav-links a').forEach(link => {
                    link.addEventListener('click', () => {
                        burgerMenu.classList.remove('active');
                        navLinks.classList.remove('active');
                    });
                });

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.nav-content')) {
                        burgerMenu.classList.remove('active');
                        navLinks.classList.remove('active');
                    }
                });
            });

        fetch('_includes/footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-placeholder').innerHTML = data;
            });

        async function fetchLatestVersion() {
            try {
                const response = await fetch('https://api.github.com/repos/lxmfy/lxmfy/releases/latest');
                const data = await response.json();
                
                if (data.tag_name) {
                    const versionText = document.getElementById('version-text');
                    const versionLink = document.getElementById('version-link');
                    
                    versionText.textContent = data.tag_name;
                    
                    versionLink.href = data.html_url;
                    
                    versionText.classList.add('version-loaded');
                }
            } catch (error) {
                console.error('Failed to fetch version:', error);
                document.getElementById('version-text').textContent = 'v0.4.2';
            }
        }

        fetchLatestVersion();

        // Register Service Worker
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then(registration => {
                console.log('Service Worker registered successfully:', registration.scope);
              })
              .catch(error => {
                console.log('Service Worker registration failed:', error);
              });
          });
        }

        // Initialize Prism highlighting
        document.addEventListener('DOMContentLoaded', () => {
            Prism.highlightAll();
        });
    </script>
</body>
</html>